<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarikh Penting Islam di Malaysia</title>
    <style>
        /* Gaya Asas */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 15px; }
        .container { width: 100%; max-width: 900px; margin: 20px auto; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 15px; font-size: 1.8em; }

        /* SEKSYEN ACARA TERHAMPIR */
        .upcoming-card { background: #e8f5e9; border-left: 5px solid #4CAF50; border-radius: 8px; padding: 20px 25px; margin-bottom: 30px; display: none; }
        .upcoming-card .label { font-size: 0.9em; font-weight: bold; text-transform: uppercase; color: #1b5e20; margin-bottom: 5px; }
        .upcoming-card .event-name { font-size: 1.7em; font-weight: bold; color: #2c3e50; margin: 0; }
        .upcoming-card .date-info { font-size: 1.1em; color: #333; margin: 8px 0; }
        .upcoming-card .countdown { font-size: 1.4em; font-weight: bold; color: #d84315; margin-top: 10px; }

        /* GAYA JADUAL (DESKTOP) */
        table { width: 100%; border-collapse: collapse; background-color: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); border-radius: 8px; overflow: hidden; }
        th, td { padding: 14px 18px; text-align: left; border-bottom: 1px solid #eef0f2; }
        thead th { background-color: #4CAF50; color: white; font-weight: bold; text-transform: uppercase; font-size: 0.9em; }
        tbody tr:nth-child(even) { background-color: #f8f9fa; }
        tbody tr:hover { background-color: #f1f1f1; }
        td .countdown-small { font-weight: bold; color: #d9534f; }
        td .event-passed { color: #777; font-style: italic; }
        .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #666; }
        .error-message { text-align: center; color: red; background-color: #fff; padding: 20px; border-radius: 8px; }
        
        /* PAPARAN KAD (MUDAH ALIH) */
        @media screen and (max-width: 768px) {
            h1 { font-size: 1.5em; }
            .upcoming-card .event-name { font-size: 1.4em; }
            .upcoming-card .date-info { font-size: 1em; }
            .upcoming-card .countdown { font-size: 1.2em; }

            table thead { display: none; }
            table tbody tr { display: block; width: 100%; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.07); }
            table td { display: block; padding: 12px 15px; border-bottom: none; }
            
            /* Stail untuk setiap baris dalam kad */
            td.mobile-event-name { font-size: 1.2em; font-weight: bold; background-color: #f8f9fa; }
            td.mobile-date-info { font-size: 0.95em; line-height: 1.5; background-color: #fff; border-top: 1px solid #eee; border-bottom: 1px solid #eee; }
            td.mobile-countdown-info { font-size: 1em; text-align: center; padding-top: 15px; padding-bottom: 15px;}
            
            tr.is-passed { opacity: 0.7; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Tarikh Penting Islam di Malaysia</h1>

        <div id="upcoming-event-container"></div>

        <table id="events-table">
            <thead>
                <tr>
                    <th>Peristiwa</th>
                    <th>Tarikh & Hari</th>
                    <th>Kira Detik</th>
                </tr>
            </thead>
            <tbody id="events-tbody"></tbody>
        </table>
        
        <div class="footer">
            <p>Tarikh adalah berdasarkan takwim dan tertakluk kepada pengumuman rasmi.</p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const hijriMonths = ["Muharam", "Safar", "Rabiulawal", "Rabiulakhir", "Jamadilawal", "Jamadilakhir", "Rejab", "Syaaban", "Ramadan", "Syawal", "Zulkaedah", "Zulhijah"];
        const daysInMalay = ["Ahad", "Isnin", "Selasa", "Rabu", "Khamis", "Jumaat", "Sabtu"];

        function getCorrectHijriDate(date) {
            try {
                const formatter = new Intl.DateTimeFormat('en-u-ca-islamic-umalqura', { day: 'numeric', month: 'numeric', year: 'numeric' });
                const parts = formatter.formatToParts(date);
                const day = parts.find(p => p.type === 'day').value;
                const monthIndex = parseInt(parts.find(p => p.type === 'month').value, 10) - 1;
                const year = parts.find(p => p.type === 'year').value;
                return `${day} ${hijriMonths[monthIndex]} ${year} H`;
            } catch (e) { return "Ralat"; }
        }

        fetch('events.json')
            .then(response => {
                if (!response.ok) { throw new Error(`Ralat ${response.status}: Fail 'events.json' tidak ditemui.`); }
                return response.json();
            })
            .then(eventData => {
                const tableBody = document.getElementById('events-tbody');
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                eventData.sort((a, b) => new Date(a.eventDate) - new Date(b.eventDate));
                
                // 1. Paparkan Acara Terhampir
                const nextEvent = eventData.find(event => new Date(event.eventDate + 'T00:00:00') >= today);
                if (nextEvent) {
                    const upcomingContainer = document.getElementById('upcoming-event-container');
                    const eventDate = new Date(nextEvent.eventDate + 'T00:00:00');
                    const timeDiff = eventDate.getTime() - today.getTime();
                    const dayDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    let countdownText = (dayDiff === 0) ? "Hari Ini!" : `${dayDiff} hari lagi`;
                    upcomingContainer.innerHTML = `
                        <div class="upcoming-card" style="display: block;">
                            <div class="label">Acara Terhampir</div>
                            <h2 class="event-name">${nextEvent.eventName}</h2>
                            <p class="date-info">${daysInMalay[eventDate.getDay()]}, ${eventDate.toLocaleDateString('ms-MY', { day: '2-digit', month: 'long', year: 'numeric' })}</p>
                            <div class="countdown">${countdownText}</div>
                        </div>`;
                }

                // 2. Paparkan Senarai Penuh (Jadual & Kad)
                eventData.forEach(event => {
                    const eventDate = new Date(event.eventDate + 'T00:00:00');
                    const newRow = tableBody.insertRow();
                    const timeDiff = eventDate.getTime() - today.getTime();
                    const dayDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    if (dayDiff < 0) newRow.classList.add('is-passed');
                    if (dayDiff === 0) newRow.classList.add('is-today');

                    const dayStr = daysInMalay[eventDate.getDay()];
                    const masihiStr = eventDate.toLocaleDateString('ms-MY', { day: '2-digit', month: 'long', year: 'numeric' });
                    const hijriStr = getCorrectHijriDate(eventDate);
                    
                    let countdownHTML = '';
                    if (dayDiff > 0) countdownHTML = `<span class="countdown-small">${dayDiff} hari lagi</span>`;
                    else if (dayDiff === 0) countdownHTML = `<span class="countdown-small">Hari Ini!</span>`;
                    else countdownHTML = `<span class="event-passed">Telah lepas</span>`;

                    // Selalu bina HTML untuk paparan jadual dahulu
                    const cellEventHTML = event.eventName;
                    const cellDateHTML_desktop = `${dayStr}<br>${masihiStr}<br>${hijriStr}`;
                    
                    // PENAMBAHBAIKAN: Gabungkan HTML untuk kedua-dua paparan dalam satu baris
                    // Paparan mudah alih akan menggunakan CSS untuk menyusun semula sel-sel ini
                    newRow.innerHTML = `
                        <td class="mobile-event-name">${cellEventHTML}</td>
                        <td class="mobile-date-info">
                            <!-- Paparan Desktop -->
                            <div class="desktop-view">${cellDateHTML_desktop}</div>
                            <!-- Paparan Mudah Alih -->
                            <div class="mobile-view">${dayStr} - ${masihiStr} - ${hijriStr}</div>
                        </td>
                        <td class="mobile-countdown-info">${countdownHTML}</td>
                    `;
                });
                
                // Tambahan CSS untuk sembunyi/papar pandangan yang betul
                const style = document.createElement('style');
                style.innerHTML = `
                    .desktop-view { display: block; }
                    .mobile-view { display: none; }
                    @media screen and (max-width: 768px) {
                        .desktop-view { display: none; }
                        .mobile-view { display: block; }
                        td.mobile-date-info { text-align: left; }
                    }
                `;
                document.head.appendChild(style);
            })
            .catch(error => {
                console.error('Gagal memuatkan data acara:', error);
                document.querySelector('.container').innerHTML = `<div class="error-message"><strong>Gagal memuatkan data.</strong><br>Sila pastikan fail 'events.json' wujud di lokasi yang sama.</div>`;
            });
    });
    </script>
</body>
</html>
