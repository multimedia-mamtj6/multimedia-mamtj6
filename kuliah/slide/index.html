<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadual Kuliah Maghrib</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000; /* Black background for default */
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
        }
        #image-container {
            width: 1920px; /* Adjust to your screen resolution if needed */
            height: 912px;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0; /* Start hidden */
            transition: opacity 1s ease-in-out;
        }
        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #message-container {
            font-size: 48px; /* Larger text for messages */
        }
    </style>
</head>
<body>
    <!-- This screen shows while data is loading -->
    <div id="loading-screen">
        <div id="loading-text">KULIAH MAGHRIB HARI INI</div>
        <div id="loading-date"></div>
    </div>

    <!-- This container will hold the image or a message -->
    <div id="image-container">
        <img id="daily-image" src="" alt="Jadual Kuliah">
    </div>
    
    <!-- This container is for showing messages like "No Kuliah" -->
    <div id="message-container" style="display: none;">Tiada Kuliah Dijadualkan Hari Ini</div>

    <script>
        // --- CONFIGURATION ---
        // IMPORTANT: You MUST change these values to your own GitHub details.
        const GITHUB_USERNAME = "YOUR_GITHUB_USERNAME";
        const GITHUB_REPO = "YOUR_GITHUB_REPOSITORY_NAME";
        const BACKGROUND_IMAGE_URL = "https://i.postimg.cc/9Q7HVK4C/JADUAL-KULIAH-copy.webp"; // Default background
        // --- END CONFIGURATION ---

        // Construct the URL for the schedule.json file
        const scheduleUrl = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/schedule.json`;

        async function fetchSchedule() {
            // Set the background immediately
            document.body.style.backgroundImage = `url('${BACKGROUND_IMAGE_URL}')`;
            
            // Set the date on the loading screen
            const today = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Kuala_Lumpur" }));
            document.getElementById('loading-date').textContent = today.toLocaleDateString('ms-MY', { day: '2-digit', month: 'long', year: 'numeric' });

            try {
                // Add a cache-busting parameter to the URL to always get the latest version
                const response = await fetch(`${scheduleUrl}?t=${new Date().getTime()}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch schedule: ${response.statusText}`);
                }
                const schedule = await response.json();

                // Find today's schedule
                const todayString = today.toISOString().split("T")[0]; // Format: YYYY-MM-DD
                const todayEntry = schedule.find(item => item.date === todayString);

                if (todayEntry && todayEntry.imageName) {
                    // An image is scheduled for today
                    const imageUrl = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/images/${todayEntry.imageName}`;
                    preloadImage(imageUrl, () => showImage(imageUrl));
                } else {
                    // No image scheduled for today
                    showMessage();
                }

            } catch (error) {
                console.error("Error fetching or processing schedule:", error);
                showMessage("Gagal memuatkan jadual."); // Show an error message
            }
        }

        function preloadImage(src, callback) {
            const img = new Image();
            img.onload = callback;
            img.onerror = () => {
                console.error("Failed to preload image:", src);
                showMessage("Imej tidak dapat dimuatkan.");
            };
            img.src = src;
        }
        
        function showImage(imageUrl) {
            const imageContainer = document.getElementById("image-container");
            const imageElement = document.getElementById("daily-image");
            
            imageElement.src = imageUrl;

            // Wait 3 seconds before hiding loading screen and showing image
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
                imageContainer.style.opacity = 1;
            }, 3000);
        }

        function showMessage(message = "Tiada Kuliah Dijadualkan Hari Ini") {
            const messageContainer = document.getElementById("message-container");
            messageContainer.textContent = message;

            // Wait 3 seconds before hiding loading screen and showing the message
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById("image-container").style.display = 'none'; // Hide the image container
                messageContainer.style.display = 'block'; // Show the message container
                messageContainer.style.opacity = 1; 
            }, 3000);
        }

        // Fetch the schedule when the page loads
        fetchSchedule();
    </script>
</body>
</html>
